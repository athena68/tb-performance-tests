# ebmpapst FFU Telemetry Data Configuration
# Configuration for telemetry data generation and ranges

# Telemetry data points definition
data_points:
  # Motor control telemetry
  actual_speed:
    unit: "RPM"
    min: 500
    max: 2000
    default: 1800
    persistent: true        # Remember last value
    variance: 0.05          # 5% variance around setpoint

  speed_setpoint:
    unit: "RPM"
    min: 500
    max: 2000
    default: 1800
    persistent: true        # Device-specific setpoint
    user_configurable: true

  speed_setpoint_percent:
    unit: "%"
    min: 25
    max: 100
    default: 90
    formula: "value / max_speed_rpm * 100"
    persistent: true

  speed_actual_percent:
    unit: "%"
    min: 25
    max: 100
    formula: "actual_speed / max_speed_rpm * 100"

  # Airflow performance
  calculated_airflow:
    unit: "m³/h"
    min: 500
    max: 2500
    default: 2330
    formula: "fan_curve_lookup(actual_speed, differential_pressure)"
    correlation: true        # Correlates with speed and pressure

  # Electrical telemetry
  dc_link_voltage:
    unit: "V"
    min: 380
    max: 420
    default: 400
    variance: 10           # ±10V variation

  dc_link_current:
    unit: "A"
    min: 2.0
    max: 6.0
    default: 3.8
    formula: "power_consumption / (voltage * efficiency)"

  power_consumption:
    unit: "W"
    min: 800
    max: 1600
    default: 1200
    formula: "torque * angular_speed / efficiency"

  # Environmental sensors
  ambient_temperature:
    unit: "°C"
    min: 22
    max: 30
    default: 25
    persistent: true        # Room-specific temperature
    slow_change: true       # Temperature changes slowly

  motor_temperature:
    unit: "°C"
    min: 40
    max: 85
    default: 65
    formula: "ambient_temperature + (load_factor * 20) + random_variation(0, 5)"
    alarm_threshold: 75     # Derating temperature
    critical_threshold: 85  # Shutdown temperature

  differential_pressure:
    unit: "Pa"
    min: 50
    max: 500
    default: 250
    persistent: true        # Filter-specific pressure
    alarm_threshold: 450    # High pressure alarm

  pressure_setpoint:
    unit: "Pa"
    min: 100
    max: 400
    default: 250
    persistent: true        # Room-specific setpoint

  # Operating status and control
  operating_hours:
    unit: "hours"
    min: 0
    max: 999999
    increment: 0.001        # Increment per message (based on publish rate)
    persistent: true

  control_mode:
    unit: ""
    values: [1, 2, 3]
    mapping:
      1: "MODBUS"
      2: "Analog 0-10V"
      3: "Digital PWM"
    default: 1

  operating_status:
    unit: ""
    values: ["RUNNING", "STOPPED", "ALARM", "FAULT", "MAINTENANCE"]
    default: "RUNNING"
    probabilities:          # Status distribution
      RUNNING: 0.94
      STOPPED: 0.03
      ALARM: 0.02
      FAULT: 0.005
      MAINTENANCE: 0.005

  alarm_code:
    unit: ""
    values: [0, 101, 102, 201, 202, 301]
    mapping:
      0: "No Alarm"
      101: "Motor Overheating"
      102: "Motor Failure"
      201: "High Differential Pressure"
      202: "Filter Blocked"
      301: "Sensor Failure"
    default: 0
    conditions:
      101: "motor_temperature > 75"
      201: "differential_pressure > 450"

  warning_code:
    unit: ""
    values: [0, 301, 302, 303, 401]
    mapping:
      0: "No Warning"
      301: "High Temperature Warning"
      302: "Filter Change Due"
      303: "Low Efficiency Warning"
      401: "Communication Warning"
    default: 0
    conditions:
      301: "motor_temperature > 65"
      302: "filter_usage_hours > 8760 * 0.8"

  modbus_status:
    unit: ""
    values: ["OK", "ERROR", "TIMEOUT"]
    default: "OK"
    error_probability: 0.001    # 0.1% error rate

  communication_errors:
    unit: "count"
    min: 0
    max: 999999
    default: 0
    increment_on_error: true
    reset_on_service: true

# Special device configurations
special_devices:
  # Devices that should show alarms
  alarm_devices:
    devices: ["DW00000015", "DW00000032", "DW00000047"]
    config:
      alarm_code: 201          # High pressure alarm
      operating_status: "ALARM"
      differential_pressure: 480

  # Devices that are stopped for maintenance
  stopped_devices:
    devices: ["DW00000008", "DW00000023", "DW00000041"]
    config:
      operating_status: "MAINTENANCE"
      actual_speed: 0
      power_consumption: 0

  # Devices that are offline
  offline_devices:
    devices: ["DW00000012", "DW00000029", "DW00000056"]
    config:
      modbus_status: "TIMEOUT"
      communication_errors: 999

# Data generation rules
generation_rules:
  publish_interval_ms: 1000     # 1 second between messages
  data_variation:
    speed_noise: 0.02           # 2% noise
    temperature_drift: 0.1       # 0.1°C per message max
    pressure_fluctuation: 2.0   # ±2 Pa pressure variation

  correlation_factors:
    airflow_speed_factor: 0.9   # Airflow correlates with speed
    power_load_factor: 0.8      # Power correlates with load
    temperature_load_factor: 0.3 # Temperature correlates with load

# Historical data simulation
historical:
  start_date: "2024-01-01"
  operating_hours_per_year: 8760
  maintenance_interval: 4380    # 6 months
  filter_change_interval: 8760  # 1 year